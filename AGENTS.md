# 苏州园林数据可视化项目

## 目录约定

项目核心需求：[docs/项目需求.md](docs/项目需求.md)
项目实现方案：[docs/实现方案.md](docs/实现方案.md)

- ./dataset: 苏州园林数据和图片
- ./archived: 旧数据，禁止使用
- ./archived/VIS: 旧版可视化项目(A)，带有 高德 API 可供参考（索引文档：docs/OLD_VIS_INDEX.md）
- ./archived/web: 旧版可视化项目(B)，可供参考。
- ./docs: 项目相关文档

唯一的真实数据源头：dataset/SuzhouGardenListFull.csv 和 dataset/images 中的图片（以园林名称命名的文件夹）
当前目录下已经使用 `npm create vite@latest -- --template vue-ts` 创建好了 Vue3 + TypeScript + Vite 项目骨架。

## 开发指引

- 在所有开发过程中，必须严格遵循"项目核心需求"和"项目实现方案"中的各项规定，确保最终交付物符合预期要求。
- 任何 "项目核心需求" 和 "项目实现方案" 中表述不清、有歧义或存在冲突的地方，必须及时要求用户确认，避免任何理解偏差导致的开发错误。
- 每次修改完成后，都需要对 AGENTS.md 进行更新，记录当前的开发进度和下一步计划。
- 开发中不需要考虑节省 Token，优先保证输出内容的完整性和准确性。

## 环境提示

- 在 zsh 中使用 "setp" 这个命令可以设置代理环境变量（在 .zshrc 中已经配置好）。
- 当前目录中可以使用 uv 管理当前 Python 版本和虚拟环境(.venv/bin/activate)。
- 当前环境中已经安装好 npm，如需安装软件请直接要求用户协助。
- 由于开发服务器运行可能导致终端阻塞，如有测试需求，请直接要求用户自行启动测试。

---

## 项目里程碑规划

### 里程碑 0：前期准备与环境配置 ✅
**目标**：完成开发环境配置，确保项目基础设施就绪

**任务清单**：
- [x] 初始化 Vue3 + Vite + TypeScript 项目骨架（已完成）
- [x] 安装核心依赖：Tailwind CSS、Pinia、ECharts、PapaParse、@amap/amap-jsapi-loader
- [x] 配置 Tailwind CSS（包括配置文件和样式入口）
- [x] 配置环境变量（创建 .env 文件，添加 VITE_AMAP_KEY）
- [x] 配置路径别名（tsconfig.json 和 vite.config.ts 中设置 @ 别名指向 src）
- [x] 验证开发服务器正常启动

**交付物**：
- ✅ 完整的 package.json 依赖清单
- ✅ 可运行的基础开发环境
- ✅ Tailwind CSS 配置完成（tailwind.config.js + postcss.config.js）
- ✅ 环境变量配置模板（.env + .env.example）
- ✅ 路径别名配置（@ -> src）

---

### 里程碑 1：数据层与类型系统 ✅
**目标**：建立数据加载、解析和类型定义体系，确保数据流通畅

**任务清单**：
- [x] 定义 TypeScript 类型接口（GardenData、Filters、NarrativeScene 等）
- [x] 实现 CSV 数据加载服务（services/dataLoader.ts）
- [x] 实现数据清洗与字段映射逻辑
  - 处理面积数值化
  - 处理文保单位级别空值（归为"未定级"）
  - 处理世界遗产空值（视为 FALSE）
  - 实现面积区间分箱逻辑
- [x] 实现派生字段计算（建造年代分类、面积区间等）
- [x] 搭建 Pinia Store 基础架构（store/index.ts、store/gardenStore.ts）
- [x] 在 Store 中实现数据状态管理
  - rawData（原始数据）
  - filteredData（过滤后数据，computed）
  - filters（筛选条件）
  - viewMode（概览/探索模式）
  - overviewNarrative（当前叙事场景）
  - selectedGarden（选中园林）
- [x] 实现统一过滤逻辑（Store getter）
- [x] 编写数据加载测试代码，验证数据正确加载

**交付物**：
- ✅ 完整的 TypeScript 类型定义文件 (src/types/index.ts)
- ✅ 可工作的数据加载与清洗模块 (src/services/dataLoader.ts)
- ✅ Pinia Store 状态管理架构 (src/stores/gardenStore.ts)
- ✅ 数据验证通过（108 条记录正确加载）
- ✅ 数据测试页面可正常显示统计信息

---

### 里程碑 2：基础布局与 UI 框架
**目标**：实现三栏式布局框架，建立模式切换机制

**任务清单**：
- [ ] 设计并实现顶部导航栏组件（HeaderNav.vue）
  - 项目标题
  - 模式切换按钮（概览/探索）
- [ ] 实现三栏式布局容器（MainLayout.vue）
  - 左侧操作区（宽度约 280-320px）
  - 中间主视图（flex-1）
  - 右侧详情区（宽度约 360-400px，仅探索模式显示）
- [ ] 实现左侧操作区框架（LeftPanel.vue）
  - 概览模式：叙事场景选择器 + 场景筛选器容器
  - 探索模式：搜索框 + 多维筛选器容器
- [ ] 实现中间主视图容器（MainView.vue）
  - 概览模式：图表网格容器
  - 探索模式：地图容器
- [ ] 实现右侧详情区框架（RightPanel.vue，仅探索模式）
  - 空状态提示
  - 区域统计视图
  - 园林详情视图
- [ ] 实现模式切换逻辑
  - Store 中的 viewMode 状态管理
  - 切换时保留筛选条件
  - UI 响应模式切换
- [ ] 实现响应式布局样式（桌面端优先）

**交付物**：
- 完整的三栏式布局框架
- 可切换的概览/探索模式
- 基础 UI 组件库结构

---

### 里程碑 3：概览模式 - 叙事场景与图表
**目标**：实现概览模式的四个叙事场景及其对应的图表与表格

**任务清单**：

#### 3.1 指标卡与 KPI 组件
- [ ] 设计并实现 KPI 指标卡组件（MetricCard.vue）
- [ ] 实现核心指标计算逻辑（园林总数、开放率、世界遗产数、平均面积等）
- [ ] 在概览模式左侧展示指标摘要

#### 3.2 叙事场景选择器
- [ ] 实现叙事场景下拉选择组件（NarrativeSelector.vue）
- [ ] 定义四个叙事场景配置
  - 空间集中与遗产核心
  - 历史谱系与认定节奏
  - 开放可达与权属/用途
  - 规模结构与资源配置
- [ ] 实现场景切换逻辑

#### 3.3 通用图表组件封装
- [ ] 封装 ECharts 基础容器组件（BaseChart.vue）
- [ ] 实现柱状图组件（BarChart.vue）
- [ ] 实现分层柱状图组件（StackedBarChart.vue）
- [ ] 实现桑基图组件（SankeyChart.vue）
- [ ] 实现直方图组件（HistogramChart.vue）

#### 3.4 场景 1：空间集中与遗产核心
- [ ] 实现区县×文保单位级别分层柱状图
- [ ] 实现区县园林数量/总面积柱状图
- [ ] 实现世界遗产在区县分布柱状图
- [ ] 实现世界遗产园林清单表格组件
- [ ] 实现场景专用筛选器（区县、文保单位级别、世界遗产、开放情况）
- [ ] 集成为完整场景视图组件（NarrativeScene1.vue）

#### 3.5 场景 2：历史谱系与认定节奏
- [ ] 实现建设时期数量柱状图
- [ ] 实现建造年代×文保单位级别分层柱状图
- [ ] 实现公布批次×建造年代分层柱状图
- [ ] 实现早期年代园林清单表格组件
- [ ] 实现场景专用筛选器（建造年代、公布批次、文保单位级别）
- [ ] 集成为完整场景视图组件（NarrativeScene2.vue）

#### 3.6 场景 3：开放可达与权属/用途
- [ ] 实现权属性质→开放情况桑基图
- [ ] 实现当前用途×开放情况分层柱状图
- [ ] 实现区县×开放情况分层柱状图
- [ ] 实现未开放园林清单表格组件
- [ ] 实现场景专用筛选器（权属性质、开放情况、当前用途、区县）
- [ ] 集成为完整场景视图组件（NarrativeScene3.vue）

#### 3.7 场景 4：规模结构与资源配置
- [ ] 实现面积区间直方图（按开放情况分层）
- [ ] 实现区县平均/总面积柱状图
- [ ] 实现建造年代平均面积柱状图
- [ ] 实现面积 Top10 园林表格组件
- [ ] 实现场景专用筛选器（面积区间、区县、开放情况、建造年代）
- [ ] 集成为完整场景视图组件（NarrativeScene4.vue）

#### 3.8 视觉编码统一化
- [ ] 定义统一的配色方案（区县、文保级别、开放情况等）
- [ ] 实现图表主题配置（theme.ts）
- [ ] 应用统一视觉编码到所有图表

**交付物**：
- 完整的概览模式四个叙事场景
- 所有必需的图表组件
- 场景切换与筛选功能正常
- 统一的视觉编码体系

---

### 里程碑 4：探索模式 - 地图集成
**目标**：集成高德地图，实现行政区边界展示和园林点位标注

**任务清单**：

#### 4.1 地图基础设施
- [ ] 实现地图加载服务（services/mapLoader.ts）
- [ ] 使用 @amap/amap-jsapi-loader 动态加载 AMap JS API
- [ ] 实现地图容器组件（MapView.vue）
- [ ] 初始化地图实例，设置苏州市为中心
- [ ] 配置地图控件（缩放、比例尺等）

#### 4.2 行政区边界展示
- [ ] 使用 DistrictLayer 或 DistrictSearch 获取苏州市及区县边界
- [ ] 实现行政区 polygon 渲染
- [ ] 实现区县分级着色（基于园林数量或面积）
- [ ] 实现行政区点击交互
- [ ] （可选）从 archived/VIS/suzhou_districts.json 复制并转换行政区边界数据到项目目录

#### 4.3 园林点位展示
- [ ] 基于经纬度创建 Marker 标注
- [ ] 实现自定义 Marker 样式（根据文保级别、开放情况着色）
- [ ] 集成 MarkerClusterer 实现点位聚合
- [ ] 实现聚合/散点模式切换
- [ ] 实现点位点击事件处理

#### 4.4 地图信息弹窗
- [ ] 实现点位点击弹窗组件（MapInfoWindow.vue）
- [ ] 显示园林基础信息（名称、开放情况、地址、面积等）
- [ ] 实现弹窗与详情面板联动

#### 4.5 地图与筛选联动
- [ ] 监听 Store 中的 filteredData 变化
- [ ] 动态更新地图点位集合
- [ ] 实现地图与图表的双向联动（点击地图更新右侧详情，筛选更新地图显示）

**交付物**：
- 可工作的高德地图集成
- 行政区边界与园林点位正确展示
- 地图交互与联动功能正常

---

### 里程碑 5：搜索与筛选功能
**目标**：实现全局筛选系统，支持多维度组合筛选

**任务清单**：

#### 5.1 筛选组件开发
- [ ] 实现下拉选择筛选器（SelectFilter.vue）
- [ ] 实现多选筛选器（MultiSelectFilter.vue）
- [ ] 实现范围筛选器（RangeFilter.vue，用于面积区间）
- [ ] 实现搜索框组件（SearchBox.vue）

#### 5.2 探索模式筛选器集成
- [ ] 集成搜索框（按名称搜索）
- [ ] 集成区县筛选器
- [ ] 集成建造年代筛选器
- [ ] 集成开放情况筛选器
- [ ] 集成文保单位级别筛选器
- [ ] 集成权属性质筛选器
- [ ] 集成世界遗产筛选器
- [ ] 集成当前用途筛选器
- [ ] 集成面积区间筛选器
- [ ] 实现清空筛选按钮

#### 5.3 筛选逻辑实现
- [ ] 在 Store 中实现多维度组合筛选逻辑
- [ ] 实现搜索逻辑（名称模糊匹配）
- [ ] 实现筛选结果缓存与优化
- [ ] 实现筛选条件持久化（模式切换时保留）

#### 5.4 筛选反馈与统计
- [ ] 显示筛选结果数量
- [ ] 显示当前生效的筛选标签
- [ ] 实现快速清除单个筛选条件

**交付物**：
- 完整的筛选组件库
- 多维度组合筛选功能正常
- 搜索功能正常（仅探索模式）

---

### 里程碑 6：详情面板与信息展示
**目标**：实现探索模式的详情展示，支持园林详情和区域统计

**任务清单**：

#### 6.1 园林详情卡片
- [ ] 实现园林详情卡片组件（GardenDetailCard.vue）
- [ ] 展示完整字段信息（名称、区县、地址、建造年代、面积、文保级别、权属性质、管理单位、保护状况、开放情况、当前用途、描述）
- [ ] 实现图片展示功能
  - 按名称匹配 dataset/images 中的图片文件夹
  - 支持图片轮播或网格展示
  - 无图片时显示占位符
- [ ] 实现详情卡片样式设计

#### 6.2 区域统计视图
- [ ] 实现区域统计组件（DistrictSummary.vue）
- [ ] 展示选中区县的园林列表（简表：名称、开放情况、权属性质）
- [ ] 展示区域统计指标（总数、开放率、平均面积等）
- [ ] 实现区域内园林点击跳转到详情

#### 6.3 右侧详情区状态管理
- [ ] 实现详情区状态切换（空状态/区域统计/园林详情）
- [ ] 监听地图点击事件，更新详情区内容
- [ ] 实现详情区关闭按钮（返回空状态）

#### 6.4 图片加载与优化
- [ ] 实现图片懒加载
- [ ] 实现图片加载失败处理
- [ ] 优化图片展示性能

**交付物**：
- 完整的详情展示功能
- 图片展示正常（按名称匹配）
- 区域统计与园林详情切换正常

---

### 里程碑 7：交互优化与视觉完善
**目标**：优化用户体验，完善视觉设计，确保交互流畅

**任务清单**：

#### 7.1 交互优化
- [ ] 实现地图与图表的高亮联动
- [ ] 实现图表悬停提示优化（tooltip 内容丰富化）
- [ ] 实现加载状态提示（loading spinner）
- [ ] 实现错误状态提示（数据加载失败、地图加载失败等）
- [ ] 优化筛选器交互体验（下拉动画、选中反馈等）
- [ ] 优化模式切换动画

#### 7.2 视觉设计完善
- [ ] 设计统一的配色方案
- [ ] 设计图表样式（网格、坐标轴、标签等）
- [ ] 设计卡片与面板阴影、边框样式
- [ ] 设计按钮与交互元素样式
- [ ] 调整字体大小与行高，确保可读性
- [ ] 设计深色/浅色主题（可选）

#### 7.3 性能优化
- [ ] 优化大数据量渲染（虚拟滚动、分页等）
- [ ] 优化图表重绘性能
- [ ] 优化地图 Marker 渲染性能
- [ ] 实现组件懒加载
- [ ] 优化打包体积

#### 7.4 响应式与兼容性
- [ ] 确保桌面端不同分辨率下正常显示
- [ ] 测试不同浏览器兼容性（Chrome、Firefox、Safari、Edge）
- [ ] 修复已知 UI 问题

**交付物**：
- 流畅的交互体验
- 统一的视觉风格
- 优化的性能表现

---

## 当前状态

**已完成**：
- 里程碑 0 - 前期准备与环境配置 ✅
- 里程碑 1 - 数据层与类型系统 ✅

**当前进度**：准备开始里程碑 2 - 基础布局与 UI 框架
**下一步**：设计并实现顶部导航栏和三栏式布局容器

### 里程碑 0 完成总结

已成功完成以下工作：

1. **依赖安装**：
   - 核心框架：Vue 3.5.24, Vite 7.2.4, TypeScript 5.9.3
   - 样式工具：Tailwind CSS 4.1.18, PostCSS, Autoprefixer
   - 状态管理：Pinia 3.0.4
   - 可视化：ECharts 6.0.0
   - 地图集成：@amap/amap-jsapi-loader 1.0.1
   - 数据解析：PapaParse 5.5.3（含类型定义）

2. **配置文件**：
   - ✅ tailwind.config.js：Tailwind CSS 配置（含苏州园林主题色）
   - ✅ postcss.config.js：PostCSS 配置
   - ✅ .env：环境变量文件（含 VITE_AMAP_KEY）
   - ✅ .env.example：环境变量模板
   - ✅ vite.config.ts：路径别名 @ -> src
   - ✅ tsconfig.app.json：TypeScript 路径映射

3. **项目基础设施**：
   - ✅ 三栏式布局准备就绪
   - ✅ Tailwind CSS 已集成到 src/style.css
   - ✅ 开发环境配置完成

### 里程碑 1 完成总结

已成功完成以下工作：

1. **TypeScript 类型系统**：
   - ✅ GardenData 接口（原始数据 + 派生字段）
   - ✅ Filters 接口（多维筛选条件）
   - ✅ ViewMode、NarrativeScene 枚举
   - ✅ Statistics、SelectionState 等辅助类型
   - ✅ 图表数据类型（ChartDataItem、StackedBarDataItem、SankeyData）

2. **数据加载服务** (src/services/dataLoader.ts)：
   - ✅ CSV 文件加载与解析（PapaParse）
   - ✅ 数据清洗函数（面积数值化、文保级别空值处理、世界遗产布尔转换）
   - ✅ 派生字段计算（年代分类、面积区间）
   - ✅ 辅助函数（获取唯一值列表）

3. **Pinia Store 状态管理** (src/stores/gardenStore.ts)：
   - ✅ 原始数据存储 (rawData)
   - ✅ 过滤后数据计算 (filteredData computed)
   - ✅ 统计指标计算 (statistics computed)
   - ✅ 多维筛选逻辑（9 种筛选维度）
   - ✅ 视图模式切换 (viewMode)
   - ✅ 选中状态管理 (selection)

4. **数据验证**：
   - ✅ 成功加载 108 条园林记录
   - ✅ 派生字段正确计算（年代分类、面积区间）
   - ✅ 统计指标正常显示（总数、开放率、世界遗产数等）
   - ✅ 测试页面可视化展示数据
