# 苏州园林数据清洗技术文档

## 1. 数据预处理需求分析

### 1.1 原始数据概况
- **数据源**：`dataset/ylml.json`
- **数据量**：约100+个园林记录
- **数据结构**：JSON格式，包含基本信息、评价、要素、媒体等字段

### 1.2 主要数据质量问题
1. **地址信息不规范**：需要提取区县和乡镇信息
2. **保护状态描述不统一**：存在"好"、"保护状态好"、"中"等不同表述
3. **园林名称格式不一致**：如"耦 园"、"网 师 园"等包含多余空格
4. **面积数据缺失**：部分园林area字段为null
5. **评价等级为文本**：需要转换为数值便于分析
6. **用途分类需要归并**：存在相似但表述不同的用途类型

## 2. 数据清洗规则

### 2.1 地址标准化规则
```
输入：原始地址字符串
处理规则：
- 提取区县信息：匹配"姑苏区"、"吴中区"、"相城区"、"吴江区"、"昆山市"等
- 提取乡镇信息：匹配"XX镇"、"XX街道"等
- 标准化格式：区县 + 乡镇 + 详细地址
输出：结构化地址信息
```

### 2.2 保护状态归一化规则
```
映射规则：
"好" | "保护状态好" | "良好" → "好"
"中" | "一般" | "中等" → "中"  
"差" | "较差" → "差"
null | "" | "未知" → "未知"
```

### 2.3 园林名称清洗规则
```
处理规则：
- 去除多余空格：使用正则表达式 \s+ 替换为单个空格
- 去除首尾空格：trim()处理
- 统一标点符号：全角转半角
示例：
"耦 园" → "耦园"
"网 师 园" → "网师园"
```

### 2.4 评价等级数值映射规则
```
评价维度：contemporaryCharacteristics, culturalTradition, featureProminence, modelRole
映射规则：
"显著" → 3
"明显" → 2  
"一般" → 1
"融合" → 2 (特殊情况，表示传统与现代的结合)
null → NaN
```

### 2.5 用途分类归并规则
```
归并规则：
"园林旅游景点" | "游览服务" | "旅游景点" → "旅游景点"
"私人住宅" | "民居" → "私人住宅"
"民宿酒店" | "酒店" → "商业用途"
"文物保护" | "博物馆" → "文化保护"
其他 → "其他用途"
```

## 3. 衍生指标计算规则

### 3.1 要素丰富度
```
计算公式：keyElements数组的长度
示例：["建筑", "花木", "叠山", "理水"] → 4
```

### 3.2 要素密度
```
计算公式：要素丰富度 / 面积(平方米) * 1000
注意：面积为null时，该指标为null
```

### 3.3 评价综合指数
```
计算公式：(当代特征 + 文化传统 + 特征显著度 + 示范作用) / 4
权重：可调整，默认等权重
```

### 3.4 开放-保护优先级
```
计算规则：
- 未开放 且 保护状态为"中"或"差" → 高优先级(3)
- 未开放 且 保护状态为"好" → 中优先级(2)  
- 开放 且 保护状态为"中"或"差" → 低优先级(1)
- 开放 且 保护状态为"好" → 无需优先(0)
```

## 4. 地理编码处理

### 4.1 地理编码需求
```
目标：将地址转换为经纬度坐标
方法：使用高德地图API或百度地图API
输出格式：
{
  "latitude": 31.2989,
  "longitude": 120.5853,
  "geocode_status": "success",
  "geocode_precision": "street"
}
```

### 4.2 缓存策略
```
缓存文件：data/geocoded_addresses.json
缓存格式：
{
  "address_hash": {
    "original_address": "原始地址",
    "latitude": 纬度,
    "longitude": 经度,
    "district": "区县",
    "town": "乡镇",
    "geocode_date": "编码日期"
  }
}
```

## 5. 输出数据格式规范

### 5.1 清洗后数据结构
```json
{
  "id": "园林唯一标识",
  "basic_info": {
    "official_name": "标准化园林名称",
    "address": {
      "original": "原始地址",
      "district": "区县",
      "town": "乡镇", 
      "detail": "详细地址",
      "latitude": "纬度",
      "longitude": "经度"
    },
    "area": {
      "value": "面积数值",
      "unit": "平方米",
      "has_data": "是否有面积数据"
    },
    "current_use": "标准化用途",
    "open_to_public": "开放状态",
    "protection_status": "标准化保护状态"
  },
  "assessments": {
    "contemporary_characteristics": "数值",
    "cultural_tradition": "数值", 
    "feature_prominence": "数值",
    "model_role": "数值",
    "comprehensive_score": "综合评分"
  },
  "elements": {
    "key_elements": ["要素列表"],
    "element_count": "要素数量",
    "element_density": "要素密度"
  },
  "derived_indicators": {
    "protection_priority": "保护优先级",
    "tourism_potential": "旅游潜力评分"
  },
  "media": {
    "image_count": "图片数量",
    "images": ["图片路径列表"]
  },
  "meta": {
    "list_date": "登记日期",
    "data_quality_score": "数据质量评分",
    "last_updated": "最后更新时间"
  }
}
```

### 5.2 数据质量标记
```
数据质量评分规则：
- 基础信息完整度 (40%)：名称、地址、用途、开放状态、保护状态
- 评价信息完整度 (30%)：四项评价指标的完整性
- 要素信息完整度 (20%)：关键要素的完整性  
- 媒体信息完整度 (10%)：图片等媒体资源

评分范围：0-100分
```

## 6. 数据验证规则

### 6.1 必填字段验证
```
必填字段：
- basic_info.official_name
- basic_info.address.district
- basic_info.current_use
- basic_info.protection_status
- elements.key_elements (至少包含一个要素)
```

### 6.2 数据一致性验证
```
验证规则：
1. 开放状态与用途的一致性检查
2. 保护状态与评价指标的合理性检查
3. 面积与要素密度的合理性检查
4. 地理坐标的有效性检查
```

### 6.3 异常值检测
```
检测规则：
1. 面积异常值：< 100平方米 或 > 100000平方米
2. 评价指标异常值：超出1-3范围
3. 图片数量异常值：> 20张
4. 地理坐标异常值：不在苏州市范围内
```

## 7. 实施计划

### 7.1 清洗流程
1. **数据加载与初步检查**
2. **字段标准化处理**
3. **地理编码处理**
4. **衍生指标计算**
5. **数据验证与质量评估**
6. **输出清洗后数据**

### 7.2 输出文件
- `data/cleaned_gardens.json` - 清洗后的主数据文件
- `data/geocoded_addresses.json` - 地理编码缓存文件
- `data/data_quality_report.json` - 数据质量报告
- `data/cleaning_log.txt` - 清洗过程日志

### 7.3 质量保证
- 清洗前后数据对比报告
- 异常数据人工复核机制
- 清洗规则版本控制
- 数据备份与恢复机制