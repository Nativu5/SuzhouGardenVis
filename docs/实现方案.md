# 苏州园林数据可视化 实现方案

## 1. 目标与范围
- 面向园林保护研究者与游客，提供“概览/探索”双模式的单页应用（桌面端）。
- 数据来源固定为 `dataset/SuzhouGardenListFull.csv`，不接入后端。
- 地图集成高德地图（AMap JS API），展示苏州市行政区与园林点位，并与图表联动。

## 2. 技术选型
- 框架：Vue 3 + Vite + TypeScript
- 样式：Tailwind CSS（支持三栏式布局与可视化面板样式）
- 图表：ECharts（或 D3，优先 ECharts 加快落地）
- 地图：`@amap/amap-jsapi-loader` + AMap JS API（含 DistrictSearch / DistrictLayer / MarkerClusterer）
- 数据解析：PapaParse（CSV 解析）
- 状态管理：Pinia（统一筛选条件与联动状态）

## 3. 项目结构（建议）
- `web/` 作为前端根目录
- `web/src/`
- `web/src/components/`：图表、筛选、列表、详情、指标卡
- `web/src/views/`：主页面（DashboardView）
- `web/src/services/`：数据加载与清洗、地图加载
- `web/src/store/`：Pinia 状态（filters、selection、metrics）
- `web/public/data/`：`SuzhouGardenListFull.csv`（构建时拷贝或软链接）

## 4. 数据处理方案

- 使用 PapaParse 读取 CSV，统一字段名映射为英文 key
- 当前 CSV 共有以下字段：
  - 公布批次
  - 名称
  - 区县
  - 地址
  - 建造年代
  - 面积（㎡）
  - 权属性质
  - 管理单位
  - 保护状况
  - 开放情况
  - 当前用途
  - 描述
  - 经度
  - 纬度
  - 文保单位级别
  - 世界遗产
- 当前图片存放在 `dataset/images/`，按“名称”命名文件夹（例如 “拙政园” 文件夹内存放该园林图片）
- 图片匹配策略：暂按名称匹配；不匹配则不展示，后续通过重命名统一
- 关键派生字段：
  - 文保单位级别空值归为“未定级”，便于分层统计。
  - 世界遗产字段空值视为 FALSE。
  - 面积区间分箱（依据数据分布设定区间），用于规模结构直方图。
- archived 目录中的任何参考文件，若需要用于运行时或构建流程，必须复制到项目目录下的非 archived 位置再使用。

## 5. 页面与布局（桌面端）
- 左侧：操作区
  - 概览模式：叙事下拉 + 场景筛选器 + 说明文案 + 指标摘要（不提供搜索）
  - 探索模式：名称搜索 + 多维筛选 + 概要数字
- 中间：主视图
  - 概览模式：整体图表叙事视图（含场景表格）
  - 探索模式：地图主视图（行政区 + 点位 + 交互弹窗）
- 右侧：详情区（仅探索模式显示）
- 顶部：标题栏（项目名称 + 简单导航 + 模式切换）

## 6. 核心功能实现
### 6.1 概览模式（整体叙事）
- 提供固定叙事下拉选择（空间集中与遗产核心、历史谱系与认定节奏、开放可达与权属/用途、规模结构与资源配置）。
- 概览模式不提供搜索与右侧详情面板，信息通过图表悬停/提示展示。
- 中间主视图随叙事切换展示不同的图表组合与说明文案。
- 图表类型严格禁止折线图、饼形图。
- 场景表格直接放置在主视图内，与图表同屏呈现。

#### 叙事场景划分（基于数据，固定选项）
- 场景名称：空间集中与遗产核心
  - 叙事意义/目的：呈现园林在苏州各区县的集中程度与高等级保护的空间分布。
  - 需哪些数据：区县、文保单位级别、世界遗产、面积（㎡）、开放情况。
  - 图表：区县×文保单位级别分层柱状图；区县园林数量/总面积柱状图；世界遗产在区县分布柱状图。
  - 表格：世界遗产园林清单（名称、区县、开放情况）。
  - 筛选器：区县、文保单位级别、世界遗产、开放情况。
- 场景名称：历史谱系与认定节奏
  - 叙事意义/目的：展示建设时期结构与认定批次的关系，观察不同年代的保护级别分布。
  - 需哪些数据：建造年代、公布批次、文保单位级别。
  - 图表：建设时期数量柱状图；建造年代×文保单位级别分层柱状图；公布批次×建造年代分层柱状图。
  - 表格：早期年代园林清单（名称、年代、文保级别）。
  - 筛选器：建造年代、公布批次、文保单位级别。
- 场景名称：开放可达与权属/用途
  - 叙事意义/目的：解释开放性差异的结构性因素，识别权属与用途对可达性的影响。
  - 需哪些数据：权属性质、当前用途、开放情况、区县。
  - 图表：权属性质→开放情况桑基图；当前用途×开放情况分层柱状图；区县×开放情况分层柱状图。
  - 表格：未开放园林清单（名称、区县、权属性质、当前用途）。
  - 筛选器：权属性质、开放情况、当前用途、区县。
- 场景名称：规模结构与资源配置
  - 叙事意义/目的：展示园林规模分布与开放性的关联，识别大型园林所在区域与时代。
  - 需哪些数据：面积（㎡）、区县、开放情况、建造年代。
  - 图表：面积区间直方图（按开放情况分层）；区县平均/总面积柱状图；建造年代平均面积柱状图。
  - 表格：面积 Top10 园林表（名称、面积、区县、开放情况）。
  - 筛选器：面积区间、区县、开放情况、建造年代。

#### 数据大盘组件（作用定义）
- KPI 指标卡：呈现整体规模、开放率、遗产数量、面积等核心指标，作为概览模式的总览锚点。
- 叙事图表容器：统一标题、口径说明、单位与缺失值提示，承载场景内图表与表格。
- 统一视觉编码：固定区县/开放情况/文保级别的颜色与排序，保证跨图一致性。
- 交互规则：以 hover 提示与局部高亮为主；仅场景内筛选，避免跨场景持久状态。

### 6.2 探索模式（地图可视化）
- 使用 `@amap/amap-jsapi-loader` 动态加载 JS API。
- 行政区边界：
  - 优先使用 `DistrictLayer` 展示苏州市及区县边界。
  - 或使用 `DistrictSearch` 获取区县 polygon 数据并渲染。
  - 行政区点击依赖 polygon 图层；如需本地边界，可参考 `archived/VIS/suzhou_districts.json` 结构生成新文件并按需懒加载（避免直接依赖 archived 目录）。
- 点位展示：
  - 基于经纬度创建 Marker。
  - 数据量可使用 `MarkerClusterer` 开启聚合/散点切换。
- 交互：
  - 点击点位 → 触发详情面板与高亮。
  - 过滤条件变化 → 更新点位集合与聚合。
- 探索模式下提供园林名称搜索功能。
- 探索模式下左侧操作区成为筛选区，用于控制地图展示内容。
- 当用户在探索模式下如果选择某个园林点位，右侧详情区展示该园林的详细信息；如仅进行筛选或仅点击了某个行政范围，右侧详情区则展示选中行政区域的整体信息。
- 当用户在探索模式下使用左侧筛选区进行筛选时，地图上的点位和聚合会根据筛选条件动态更新。

### 6.3 信息展示
- 概览模式不显示右侧详情区域，仅提供图表悬停提示。
- 探索模式下选中区域时展示表格（名称、区县、开放情况、权属）。
- 探索模式下选中单个园林时展示卡片视图（描述、管理单位、文保级别、面积、地址）；若 `dataset/images` 有对应图片，则按名称匹配加载。

### 6.4 搜索与筛选
- 搜索：仅探索模式提供，名称匹配（前端搜索）。
- 筛选：探索模式支持区县、建造年代、开放情况、文保级别、权属性质、世界遗产、当前用途、面积区间；概览模式仅提供场景限定筛选器。
- 清空筛选：恢复全量数据。

## 7. 状态管理与联动
- Pinia store 持有：
  - `filters`：当前筛选条件
  - `selectedGarden`：当前选中的园林
  - `filteredData`：计算后的数据集
  - `viewMode`：概览/探索
  - `overviewNarrative`：当前叙事主题
- 统一过滤逻辑：在 store 的 getter 中处理，图表/地图/列表共用。
- 模式切换保留 `filters`，概览图表与探索地图共享同一 `filteredData`。

## 8. 配置与部署
- AMap Key 通过 `.env` 注入（如 `VITE_AMAP_KEY`）。
- 构建产物为静态文件，可部署至任意静态托管服务。

## 9. 实施步骤（里程碑）
1. 初始化前端工程（Vue 3 + Vite + Tailwind + TS）
2. 数据加载与清洗模块（CSV 解析 + 字段映射）
3. 三栏式布局与基础 UI 框架 + 模式切换框架
4. 概览模式叙事图表与表格（柱状/分层柱状/桑基/直方）
5. 地图集成（行政区边界 + 点位）
6. 筛选/搜索/联动功能
7. 详情面板与图片支持
8. 交互优化与视觉完善

## 10. 验收映射
- 指标卡与图表正常渲染并反映 CSV 数据。
- 地图展示苏州市行政区与园林点位，可点击交互。
- 搜索仅探索模式可用，筛选/点选正常工作，地图与图表联动。
- 概览模式具备固定叙事下拉，按预设图表组合展示洞察。
- 无需后端服务，静态部署可运行。
