        # 苏州园林数据可视化项目实现总结

## 1. 项目概况

本项目是一个面向园林保护研究者与游客的单页应用（SPA），旨在通过可视化手段展示苏州园林的时空分布、保护状况及开放程度。项目采用“概览/探索”双模式设计，分别满足宏观叙事与微观探索的需求。

- **项目状态**：已完工（里程碑 0-7 全部完成）
- **部署方式**：纯静态部署（无后端依赖）
- **数据源**：本地 CSV 文件与静态图片资源

## 2. 技术栈与架构

### 2.1 核心技术栈

- **框架**：Vue 3 + TypeScript + Vite
- **样式**：Tailwind CSS
- **状态管理**：Pinia
- **可视化**：
  - 图表：ECharts 5
  - 地图：高德地图 JS API v2.0 (`@amap/amap-jsapi-loader`)
- **工具库**：
  - CSV 解析：PapaParse
  - 路径别名：`@` 指向 `src`

### 2.2 目录结构

```
src/
├── components/         # 组件库
│   ├── charts/         # ECharts 图表封装 (Bar, Sankey, Radar...)
│   ├── detail/         # 详情面板组件 (GardenDetail, DistrictStats...)
│   ├── filters/        # 筛选器组件 (Select, Range, MultiSelect...)
│   ├── layout/         # 布局组件 (MainLayout, HeaderNav...)
│   ├── map/            # 地图相关组件 (MapView...)
│   └── overview/       # 概览模式叙事场景组件 (NarrativeScene...)
├── config/             # 配置文件 (theme.ts, echarts.ts)
├── services/           # 业务服务
│   ├── dataLoader.ts   # 数据加载、清洗与派生字段计算
│   └── mapLoader.ts    # 地图 API 加载与初始化
├── stores/             # Pinia 状态管理 (gardenStore.ts)
├── types/              # TypeScript 类型定义
└── utils/              # 工具函数 (chartDataProcessor.ts)
```

## 3. 核心设计与实现

### 3.1 数据流架构

项目采用单向数据流设计，确保数据的一致性与可追溯性。

1. **加载层**：`dataLoader.ts` 读取 CSV，执行清洗（处理空值、数值化）和字段派生（计算年代分类、面积分箱）。
2. **状态层**：`gardenStore` 持有 `rawData`（原始数据）和 `filters`（筛选条件）。
3. **计算层**：通过 Pinia getter 实时计算 `filteredData`，供所有视图消费。
4. **视图层**：图表和地图监听 `filteredData` 变化，实现响应式更新。

### 3.2 双模式设计

- **概览模式 (Overview)**
  - **核心理念**：基于预设叙事场景的数据故事讲述。
  - **实现**：通过 `NarrativeSelector` 切换 4 个场景组件，每个场景包含特定的图表组合与 KPI 指标。
  - **场景**：
    1. 空间集中与遗产核心
    2. 历史谱系与认定节奏
    3. 开放可达与权属/用途
    4. 规模结构与资源配置

- **探索模式 (Explore)**
  - **核心理念**：基于地理空间的用户自主探索。
  - **实现**：集成高德地图，支持点位聚合/散点切换、行政区划高亮。
  - **交互**：左侧提供多维度筛选与搜索，右侧展示选中园林详情或区域统计。

### 3.3 可视化系统

- **统一视觉编码**：在 `src/config/theme.ts` 中定义了全局配色方案（区县、文保级别、开放情况等），确保跨图表与地图的颜色一致性。
- **图表封装**：封装了 `BaseChart` 组件处理 ECharts 的初始化、销毁与 Resize，业务图表组件只需关注配置项生成。
- **地图集成**：
  - 使用 `DistrictSearch` 获取行政区边界并渲染 Polygon。
  - 使用自定义 `Marker` 展示园林点位，颜色与图表系统保持一致。
  - 实现了地图与详情面板的双向高亮联动。

### 3.4 详情与交互

- **图片懒加载**：详情面板中的图片组件支持懒加载与错误处理，自动匹配 `public/dataset/images` 下的资源。
- **雷达图评估**：引入行政区划数据（人口、面积），计算“可访问指数”等衍生指标，通过雷达图展示区域综合实力。

## 4. 维护与拓展指南

### 4.1 数据更新

- **园林数据**：直接替换 `public/dataset/SuzhouGardenListFull.csv`，保持表头结构一致即可。
- **图片资源**：在 `public/dataset/images/` 下以园林名称创建文件夹并放入图片。
- **行政区数据**：更新 `public/dataset/SuzhouDistricts.csv` 可调整人口与面积数据。

### 4.2 功能拓展

- **新增图表**：
  1. 在 `src/components/charts/` 下新建组件。
  2. 使用 `useChartOption` 组合配置。
  3. 在 `src/components/overview/` 下的场景组件中引入。
- **修改叙事场景**：
  1. 在 `src/types/index.ts` 中更新 `NarrativeScene` 类型。
  2. 在 `src/components/overview/` 下新增或修改场景组件。
  3. 在 `src/components/layout/LeftPanel.vue` 中更新选择器配置。
- **地图定制**：
  1. 样式修改：`src/components/map/MapView.vue` 中的 `initMap` 方法。
  2. 点位逻辑：`src/components/map/MapView.vue` 中的 `updateMarkers` 方法。

### 4.3 性能优化提示

- 当前已开启 ECharts 按需引入与代码分割。
- 若数据量显著增加（>1000条），建议在地图组件中开启海量点展示（`MassMarks`）替代当前的 `Marker` 方案。

## 5. 总结

本项目成功构建了一个结构清晰、扩展性强的数据可视化平台。通过严格的类型系统和模块化设计，保证了代码的可维护性。双模式架构有效地平衡了专业分析与公众科普的需求，为苏州园林的数字化保护与传播提供了有力工具。
